<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Saver Pro - Fixed Copy</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .container { max-width: 480px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #1a73e8; text-align: center; }
        
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        .btn-group { display: flex; gap: 8px; margin-bottom: 15px; }
        button { cursor: pointer; border: none; border-radius: 6px; font-weight: bold; transition: 0.2s; font-size: 14px; }
        button:hover { opacity: 0.8; }

        .btn-save { background: #28a745; color: white; width: 100%; padding: 12px; margin-bottom: 10px; }
        .btn-update { background: #fd7e14; color: white; width: 100%; padding: 12px; margin-bottom: 10px; }
        .btn-export { background: #007bff; color: white; padding: 10px; flex: 1; }
        .btn-import { background: #6c757d; color: white; padding: 10px; flex: 1; }
        
        /* Tombol Salin Semua */
        .btn-copy-all { background: #6f42c1; color: white; width: 100%; padding: 12px; margin-top: 10px; display: none; }
        
        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { background: #f8f9fa; padding: 12px; margin-bottom: 8px; border-radius: 8px; display: flex; flex-direction: column; border: 1px solid #eee; }
        
        .email-display { word-break: break-all; font-weight: 500; margin-bottom: 8px; color: #444; }
        
        .action-btns { display: flex; gap: 5px; justify-content: flex-end; }
        .action-btns button { padding: 6px 12px; font-size: 11px; }
        
        .btn-copy { background: #17a2b8; color: white; }
        .btn-edit { background: #ffc107; color: black; }
        .btn-delete { background: #dc3545; color: white; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 8px 16px; border-radius: 20px; display: none; font-size: 12px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="container">
    <h3>Penyimpan Email</h3>
    
    <input type="email" id="emailInput" placeholder="Masukkan email...">
    <button id="submitBtn" class="btn-save" onclick="handleAction()">Simpan Email</button>
    
    <div class="btn-group">
        <button class="btn-export" onclick="exportJSON()">Ekspor JSON</button>
        <input type="file" id="importFile" style="display:none" onchange="importJSON(event)">
        <button class="btn-import" onclick="document.getElementById('importFile').click()">Impor JSON</button>
    </div>

    <ul id="emailList"></ul>
    
    <button id="copyAllBtn" class="btn-copy-all" onclick="copyAllEmails()">Salin Semua Email</button>
</div>

<div id="toast" class="toast">Email berhasil disalin!</div>

<script>
    let emails = JSON.parse(localStorage.getItem('emails')) || [];
    let editIndex = null;

    function render() {
        const list = document.getElementById('emailList');
        const copyAllBtn = document.getElementById('copyAllBtn');
        list.innerHTML = '';
        
        emails.forEach((email, index) => {
            list.innerHTML += `
                <li>
                    <span class="email-display">${email}</span>
                    <div class="action-btns">
                        <button class="btn-copy" onclick="copyToClipboard('${email}')">Salin</button>
                        <button class="btn-edit" onclick="startEdit(${index})">Edit</button>
                        <button class="btn-delete" onclick="deleteEmail(${index})">Hapus</button>
                    </div>
                </li>`;
        });
        
        // Tampilkan tombol Salin Semua hanya jika ada data
        copyAllBtn.style.display = emails.length > 0 ? 'block' : 'none';
        
        localStorage.setItem('emails', JSON.stringify(emails));
    }

    function handleAction() {
        const input = document.getElementById('emailInput');
        const submitBtn = document.getElementById('submitBtn');
        const val = input.value.trim();
        
        if (!val) return;

        if (editIndex === null) {
            emails.push(val);
        } else {
            emails[editIndex] = val;
            editIndex = null;
            submitBtn.innerText = "Simpan Email";
            submitBtn.className = "btn-save";
        }
        input.value = '';
        render();
    }

    function startEdit(index) {
        document.getElementById('emailInput').value = emails[index];
        editIndex = index;
        const btn = document.getElementById('submitBtn');
        btn.innerText = "Update Email";
        btn.className = "btn-update";
        document.getElementById('emailInput').focus();
    }

    function deleteEmail(index) {
        if (confirm("Hapus email ini?")) {
            emails.splice(index, 1);
            render();
        }
    }

    // --- FITUR SALIN SEMUA ---
    function copyAllEmails() {
        if (emails.length === 0) return;
        const allText = emails.join('\n');
        copyToClipboard(allText);
        
        // Ubah pesan toast sebentar untuk konteks "semua"
        const toast = document.getElementById('toast');
        toast.innerText = "Semua email berhasil disalin!";
        setTimeout(() => { toast.innerText = "Email berhasil disalin!"; }, 2000);
    }

    // --- LOGIKA SALIN (Tetap Sama) ---
    function copyToClipboard(text) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                showToast();
            }).catch(() => {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }

    function fallbackCopy(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        textArea.style.top = "0";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            showToast();
        } catch (err) {
            alert('Gagal menyalin teks.');
        }
        document.body.removeChild(textArea);
    }

    function showToast() {
        const toast = document.getElementById('toast');
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2000);
    }

    // --- EKSPOR & IMPOR ---
    async function exportJSON() {
        if (emails.length === 0) return alert("Data kosong!");
        const dataStr = JSON.stringify(emails, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'emails_backup.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function importJSON(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (Array.isArray(data)) { 
                    emails = data; 
                    render(); 
                    alert("Data berhasil diimpor!");
                }
            } catch (err) { alert("Format file JSON tidak valid!"); }
        };
        reader.readAsText(file);
    }

    render();
</script>
</body>
</html>
